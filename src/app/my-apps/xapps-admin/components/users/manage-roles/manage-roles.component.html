<div class="main-manage-roles">
  <div class="breadcrumbs-outer">
    <ul>
      @if (userDetails?.first_name) {
      <li><a (click)="navigateToUsers()" class="label medium"> Users </a></li>
      <li><span>/</span></li>
      <li><a (click)="navigateToUsers()" class="label medium">{{ userDetails?.first_name || "" }} {{
          userDetails?.last_name || "" }} </a></li>
      <li><span>/</span></li>
      <li class="label medium">Manage Roles</li>
      }
    </ul>
  </div>


  <div class="application-container">
    <div class="application-container-inner">

      <div class="subheader-container">
        <div class="tc-manage-screen">
          <div class="heading">
            <button class="d-btn d-btn--circle sm white-bg-circle _cp" (click)="navigateToUsers()">
              <span class="res-menu-btn-hide back-button icon-leftarrow icon--sm"></span>
            </button>
            <div class="application-text">
              <h2>{{ userDetails?.first_name || "" }} {{ userDetails?.last_name || "" }}</h2>
            </div>
          </div>

          <div class="right">
            <!-- search bar -->
            <div class="listing-page-buttons-manage-screen">
              <div class="search-n-btn">
                <div class="search-bar search-bar--rounded ">
                  <span class="material-symbols-outlined btn-icon">
                    search
                  </span>
                  <form>
                    <input type="text" placeholder="Search here..." (input)="searchRoles($event)"
                      title="This search will be performed on all displayed and hidden columns." />
                  </form>
                </div>
              </div>
            </div>
            <div class="sh-buttons">
              <div class="btns-res-divider">
                @if (applications.length) {
                <div ngbDropdown class="d-inline-block nav-dropdown" [autoClose]="'outside'" #dropdown1="ngbDropdown">
                  <button type="button" class="dropdown-btn d-btn d-btn--secondary sm tooltip-btn" id="dropdownBasic1"
                    [ngbTooltip]="selectedApplication?.application_name" ngbDropdownToggle placement="bottom"
                    triggers="hover">
                    <span class="material-symbols-rounded btn-icon">filter_list</span>
                    <p class="">Application: {{ selectedApplication?.application_name || "" }}</p>
                  </button>

                  <div class="dropdown-menu" ngbDropdownMenu aria-labelledby="dropdownBasic1">
                    <ul>
                      <li>
                        <button ngbDropdownItem
                          (click)="setSelectedApplication({id: 'all', application_name: 'All',}); dropdown1.close()">
                          <p> All</p>
                        </button>
                        @for (application of applications; track $index) {
                        <button ngbDropdownItem (click)="setSelectedApplication(application); dropdown1.close()">
                          <p>{{ application.application_name }}</p>
                        </button>
                        }
                      </li>
                    </ul>

                  </div>
                </div>
                }
              </div>
              <div class="btns-res-divider">
                <button class="d-btn d-btn--secondary sm tooltip-btn" (click)="refreshManageRole()" placement="start" triggers="hover">
                  <span class="material-symbols-rounded btn-icon">refresh</span>
                  <p class="">Refresh</p>
                </button>
                <button class="d-btn d-btn--secondary sm" type="button" (click)="navigateToUsers()">
                  <span class="material-symbols-outlined btn-icon">close</span>
                  <p class=""> Cancel</p>
                </button>
                <!-- save -->
                <button class="d-btn d-btn--primary sm" type="submit" (click)="submitSelectedRoles()">
                  <span class="material-symbols-outlined btn-icon">check</span>
                  <p class=""> Save</p>
                </button>
              </div>
            </div>
          </div>


        </div>
      </div>


      <div class="content d-flex justify-content-between">
        <div class="left d-flex flex-column">
          <div class="innerbox">
            <div class="heading-row">
              <h3>Select Roles</h3>
              <div (click)="assignAllRoles()" class="assign-all">
                <span class="icon-add">+ </span>
                <span class="text-add">Assign all</span>
              </div>
            </div>
            <ul class="select-box">
              <li *ngFor="
              let role of unassignedRoles(); let roleIndex = index"
                class="d-flex align-items-center justify-content-between" (click)="selectRole(role)"
                (dblclick)="manageRole(role, true)" [ngClass]="{ 'selected-user': role.isSelected }">
                <span>
                  {{ role.role_name }}
                </span>
              </li>
            </ul>
          </div>
        </div>

        <div class="center">
          <button class="d-btn d-btn--circle md">
            <img (click)="moveSelectedRoles(true)" src="assets/images/right-arrow.svg" alt="" />
          </button>
          <button class="d-btn d-btn--circle md">
            <img (click)="moveSelectedRoles(false)" src="assets/images/left-arrow.svg" alt="" />
          </button>
        </div>
        <!-- right side -->
        <div class="right d-flex flex-column">
          <div class="innerbox">

            <div class="heading-row">
              <h3>Selected Roles</h3>
              <div (click)="removeAllRoles()" class="remove-all">
                <span class="icon-remove">- </span>
                <span class="text-remove">Remove all</span>
              </div>
            </div>
            <ul class="select-box">
              <li *ngFor="let role of assignedRoles(); let roleIndex = index" (click)="selectRole(role)"
                (dblclick)="manageRole(role, false)" [ngClass]="{ 'selected-user': role.isSelected }">
                <span>{{ role.role_name }}</span>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>