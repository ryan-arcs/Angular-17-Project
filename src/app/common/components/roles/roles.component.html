<ng-template #actionRow let-row="row" let-value="value" let-i="index">
  <span class="action-row">
    @if (
    (!isActionSuppressed("manage_permissions") &&
    isActionPermitted("manage_permissions")) ||
    isActionPermitted("manage_users") ||
    (!isActionSuppressed("edit") && isActionPermitted("edit")) ||
    (!isActionSuppressed("delete") && isActionPermitted("delete"))
    ) {
    <div ngbDropdown container="body" class="ag-grid-more-outer">
      <button type="button" class="d-btn d-btn--circle vs" id="dropdownBasic1" title="options" ngbDropdownToggle>
        <span class="material-symbols-rounded more-icon">more_horiz</span>
      </button>
      <div class="dropdown-menu" ngbDropdownMenu aria-labelledby="dropdownBasic1">
        @if (!isActionSuppressed("manage_permissions") && isActionPermitted("manage_permissions")) {
        <button ngbDropdownItem class="d-btn d-btn--tertiary sm" (click)="onCellClicked(row, 'manage-permissions')">
          <i style="font-size: 17px; cursor: pointer" class="fa fa-key btn-icon"></i>
          <p>Manage Permissions</p>
        </button>
        }
        @if (isActionPermitted("manage_users")) {
        <button ngbDropdownItem class="d-btn d-btn--tertiary sm" (click)="onCellClicked(row, 'manage-users')">
          <i style="font-size: 17px; cursor: pointer" class="fa fa-users btn-icon"></i>
          <p>Manage Users</p>
        </button>
        }
        @if (!isActionSuppressed("edit") && isActionPermitted("edit")) {
        <button ngbDropdownItem class="d-btn d-btn--tertiary sm" (click)="onCellClicked(row, 'edit-role')">
          <i style="font-size: 17px; cursor: pointer;line-height:24px;" class="fa fa-edit btn-icon"></i>
          <p>Edit</p>
        </button>
        }
        @if (!isActionSuppressed("delete") && isActionPermitted("delete")) {
        <button ngbDropdownItem class="d-btn d-btn--tertiary sm" (click)="onCellClicked(row, 'delete-role')">
          <i style="font-size: 17px; cursor: pointer;line-height:24px;" class="fa fa-trash btn-icon"></i>
          <p>Delete</p>
        </button>
        }
      </div>
    </div>
    } @else {
    <span> - </span>
    }
  </span>
</ng-template>

<ng-template #dateTemplate let-row="row" let-value="value">
  @if (value) {
  <div class="sell-outer">
    <img src="assets/images/calendar.svg" />
    <span>{{ value | date: defaultDateFormat || "-" }}</span>
  </div>
  } @else {
  <span>-</span>
  }
</ng-template>

<ng-template #creatorTemplate let-row="row" let-value="value">
  @if (row?.creator) {
  <span>{{
    (row.creator.firstName || "") + " " + (row.creator.lastName || "")
    }}</span>
  } @else {
  <span>-</span>
  }
</ng-template>

<ng-template #updatorTemplate let-row="row" let-value="value">
  @if (row?.updator) {
  <span>{{
    (row.updator.firstName || "") + " " + (row.updator.lastName || "")
    }}</span>
  } @else {
  <span>-</span>
  }
</ng-template>

<ng-template #statusTemplate let-value="value">
  <div class="sell-outer" style="
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 5px;
    ">
    <div class="circul-status" [style.background-color]="value ? 'green' : 'red'"
      style="height: 10px; width: 10px; border-radius: 50%"></div>
    <span class="top-1">
      {{ value ? "Active" : "Inactive" }}
    </span>
  </div>
</ng-template>

<div class="application-container grid-scroll-handling" [class.grid-scroll-roles]="this.application">
  <div class="application-container-inner">
    <!-- left-subheader -->
    <div class="subheader-container">
      <div class="tc-manage-screen">
        <div class="heading">
        <h2>Roles</h2>
        </div>
        <div class="right">
          <div class="listing-page-buttons-manage-screen">
          <div class="search-n-btn">
            <div class="search-bar search-bar--rounded">
              <span class="material-symbols-outlined btn-icon">
                search
              </span>
              <form [formGroup]="searchForm" (ngSubmit)="shootSearch()">
                <div class="search-outer">

                  <input type="text" formControlName="filter" placeholder="Search here..."
                    title="This search will be performed on all displayed and hidden columns." />
                  <button class="d-btn d-btn--primary sm search-btn" type="submit">Search</button>
                </div>
              </form>
            </div>
          </div>
          </div>
          <div class="sh-buttons">
            @if (applications.length && !application) {
            <div class="btns-res-divider">
            <div ngbDropdown class="d-inline-block nav-dropdown" [autoClose]="'outside'" #dropdown="ngbDropdown">
              <button type="button" class="dropdown-btn d-btn d-btn--secondary sm tooltip-btn" id="dropdownBasic1"
                [ngbTooltip]="selectedApplication?.application_name" ngbDropdownToggle placement="bottom" triggers="hover">
                <span class="material-symbols-rounded btn-icon">filter_list</span>
                <p class="">Application: {{ selectedApplication?.application_name || "" }}</p>
              </button>

              <div class="dropdown-menu" ngbDropdownMenu aria-labelledby="dropdownBasic1">
                <ul>
                  <li>
                    <button ngbDropdownItem
                      (click)="onApplicationChange({id: 'all', application_name: 'All'}); dropdown.close()">
                      <p> All</p>
                    </button>
                    @for (application of applications; track $index) {
                    <button ngbDropdownItem
                      (click)="onApplicationChange({id: application.id, application_name: application.application_name}); dropdown.close()">
                      <p>{{ application.application_name }}</p>
                    </button>
                    }
                  </li>
                </ul>
              </div>
            </div>
            </div>
            }
            <div class="btns-res-divider">
            <button class="d-btn d-btn--secondary sm tooltip-btn" (click)="refreshRolesList()" placement="start"
              [ngbTooltip]="isMobileScreen() ? 'Refresh' : ''" triggers="hover">
              <span class="material-symbols-rounded btn-icon">refresh</span>
              <p class="">Refresh</p>
            </button>
            @if (columnFilters.length || searchTerm) {
            <button class="d-btn d-btn--secondary sm tooltip-btn" (click)="clearFilters()" placement="start"
              [ngbTooltip]="isMobileScreen() ? 'Clear Filter' : ''" triggers="hover">
              <span class="material-symbols-rounded btn-icon">filter_list_off</span>
              <p class="">Clear Filter</p>
            </button>
            }
            @if (!isActionSuppressed("add") && isActionPermitted("add")) {
            <button class="d-btn d-btn--primary desktop sm tooltip-btn" (click)="navigateToAddRoles()" placement="start"
              [ngbTooltip]="isMobileScreen() ? 'Add' : ''" triggers="hover">
              <span class="material-symbols-outlined btn-icon">
                add_2
              </span>
              <p class="">Add</p>
            </button>
            }
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- grid -->
    <div class="panel-and-table">
      <div class="logs-container logs-cell-padding inner-pages-footer">
        <app-data-grid [gridName]="gridName" [gridColumns]="columns" [gridRows]="rolesList"
          [columnFilters]="columnFilters" [actionRowTemplate]="actionRow" [pagination]="pagination"
          [externalPagination]="false" [externalSorting]="false" [pageSizes]="paginationPageSizeSelector"
          [enableInlineSearch]="false" [selectedPageSize]="defaultSize" [gridSorts]="gridSort.prop ? [gridSort] : []"
          [errorMessage]="errorMessage" (onGridSort)="onSort($event)"
          (onGridPageSizeChange)="onGridPageSizeChange($event)" (onGridPageChange)="onGridPageChange($event)"
          (onColumnFilterChange)="onColumnFilterChange($event)">
        </app-data-grid>
      </div>
    </div>
  </div>
</div>